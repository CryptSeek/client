<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptSeek</title>
    <link rel="stylesheet" href="./styles.css">
</head>

<body>
    <div class="body-flex">

        <div class="sidebar">
            <h2>My Friends</h2>
            <div id="user-list">
                <div>
                    <p><a class="side-nav-item" style="margin-bottom: 1em;" href="#cs-add-friend">Add a Friend</a></p>
                    <!-- Links generated by loaded messages -->
                </div>
            </div>
        </div>

        <div class="main-content">
            <nav class="top-nav">
                <img src="./logo.png" style="width: 200px; text-align: left;"
                     alt="CryptSeek Logo">
                <h1>Your Friends</h1>
                <div style="text-align: right;">
                    <a class="top-nav-item" href="index.html">Home</a>
                    <a class="top-nav-item" href="settings.html">Settings</a>
                </div>
            </nav>

            <div class="message-content-area">
                <div id="message-log">
                    <div id="cs-add-friend" class="info-box">
                        <h3>Add a friend:</h3>
                        <div>
                            <h4>Steps:</h4>
                            <ol>
                                <li>Receive a token from a new friend</li>
                                <li>Paste the token here: <br><input placeholder="token" type="text"></li>
                            </ol>
                        </div>
                    </div>
                    <!-- Generate areas based on received message senders -->
                </div>
            </div>

        </div>
    </div>
</body>

<script>
    const { ipcRenderer } = require("electron");
    const Store = require('electron-store');
    const fs = require('fs');

    // DOM objects for showing messages
    const logArea = document.getElementById('message-log');
    const userList = document.getElementById('user-list').children[0];

    const store = new Store();
    const bouncerAddress = store.get('bouncerAddress');
    const username = store.get('username');

    // Load friends from storage
    let dataPath = '';
    ipcRenderer.on('path-relay', (event, data) => {
        dataPath = data['data'];

        let friends = fs.readdirSync(`${dataPath}/data`);
        friends.forEach((friend) => {

            let newUser = document.createElement('div');
            newUser.id = friend;
            newUser.classList.add('user-log');
            newUser.innerHTML =
                "<h3>Settings for <span>" + friend + "</span></h3>" +
                "<div>" +
                "<button class='btn btn-warning'>Remove Friend</button>" +
                "</div>";
            logArea.appendChild(newUser);

            newUser.children[1].firstChild.id = "rem-" + friend;
            newUser.children[1].firstChild.addEventListener('click', removeFriend);

            let userLink = document.createElement('p');
            userLink.classList.add('side-nav-p')
            userLink.innerHTML = `<a class="side-nav-item" href="#${friend}">${friend}</a>`;
            userList.appendChild(userLink);
        });
    });

    if (dataPath === '') {
        ipcRenderer.send('get-path');
    }

    function removeFriend(event) {
        console.log(event.target);
        let friendName = event.target.parentNode.parentNode.id;
        if (confirm("Are you sure you want to remove this friend\nThis cannot be undone!")) {
            fs.rmSync(`${dataPath}/data/${friendName}`, {recursive: true});
            window.location.reload();
        }


    }

</script>

</html>